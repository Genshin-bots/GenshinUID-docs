import{_ as e}from"./chunks/PageInfo.vue_vue_type_script_setup_true_lang.576d70b4.js";import{_ as o}from"./chunks/Badge.167f4610.js";import{_ as r,o as c,c as t,k as a,a as s,H as n,Q as i}from"./chunks/framework.d8868ba7.js";import"./chunks/commonjsHelpers.725317a4.js";const v=JSON.parse('{"title":"插件获取/调用/建立数据库(GsData.db)","description":"","frontmatter":{"author":"Wuyi无疑","contributors":["Wuyi无疑"]},"headers":[],"relativePath":"CodePlugins/PluginsDataBase.md","filePath":"CodePlugins/PluginsDataBase.md","lastUpdated":1703680098000}'),y={name:"CodePlugins/PluginsDataBase.md"},E={id:"插件获取-调用-建立数据库-gsdata-db",tabindex:"-1"},d=a("a",{class:"header-anchor",href:"#插件获取-调用-建立数据库-gsdata-db","aria-label":'Permalink to "插件获取/调用/建立数据库(GsData.db)<Badge type="tip" text="简单" />"'},"​",-1),m=i(`<div class="tip custom-block"><p class="custom-block-title">💡 提醒</p><p>💡<strong>强烈推荐</strong>使用该方法去写数据库，基类提供了大部分较为常用的数据库方法（增删改查）</p><p>继承已经写好的基类，可以在较少代码量的前提下，生成专属插件的表并共享所有基类方法</p><p>有非常多额外的扩展方法（实现bot_id管理、多uid绑定、随机调用CK等等）</p></div><h4 id="第一步、继承基类-建立自己的表" tabindex="-1">第一步、继承基类，建立自己的表 <a class="header-anchor" href="#第一步、继承基类-建立自己的表" aria-label="Permalink to &quot;第一步、继承基类，建立自己的表&quot;">​</a></h4><p><a href="https://github.com/KimigaiiWuyi/WzryUID/blob/main/WzryUID/utils/database/models.py" target="_blank" rel="noreferrer">参考</a></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> gsuid_core.utils.database.base_models </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Bind, User</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WzryBind</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Bind</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">table</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 注意，这里的列名无需新增id等基类已经有的列，只需要根据自己实际需求新增列名即可</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 具体基类有什么列可以点进Bind类去查看</span></span>
<span class="line"><span style="color:#E1E4E8;">    uid: Optional[</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">title</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;王者荣耀UID&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WzryUser</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">table</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    uid: Optional[</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">title</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;王者荣耀UID&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> gsuid_core.utils.database.base_models </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Bind, User</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WzryBind</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Bind</span><span style="color:#24292E;">, </span><span style="color:#E36209;">table</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 注意，这里的列名无需新增id等基类已经有的列，只需要根据自己实际需求新增列名即可</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 具体基类有什么列可以点进Bind类去查看</span></span>
<span class="line"><span style="color:#24292E;">    uid: Optional[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">, </span><span style="color:#E36209;">title</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;王者荣耀UID&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WzryUser</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">User</span><span style="color:#24292E;">, </span><span style="color:#E36209;">table</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    uid: Optional[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">, </span><span style="color:#E36209;">title</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;王者荣耀UID&#39;</span><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="第二步、调用方法" tabindex="-1">第二步、调用方法 <a class="header-anchor" href="#第二步、调用方法" aria-label="Permalink to &quot;第二步、调用方法&quot;">​</a></h4><p><a href="https://github.com/KimigaiiWuyi/WzryUID/blob/main/WzryUID/wzryuid_user/__init__.py" target="_blank" rel="noreferrer">参考</a></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> asyncio</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> ..utils.database.models </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> WzryBind</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 注意，继承不同基类的表，方法可能不同，建议使用VSC查看所有方法，以及所有入参</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># GsCore完全使用TypeHint进行类型判断，如果VSC中代码用红线标注，务必查看函数入参，确保修改正确</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> WzryBind.insert_uid(qid, ev.bot_id, uid, ev.group_id)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">asyncio.run(main())</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> asyncio</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> ..utils.database.models </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> WzryBind</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 注意，继承不同基类的表，方法可能不同，建议使用VSC查看所有方法，以及所有入参</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># GsCore完全使用TypeHint进行类型判断，如果VSC中代码用红线标注，务必查看函数入参，确保修改正确</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> WzryBind.insert_uid(qid, ev.bot_id, uid, ev.group_id)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">asyncio.run(main())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="第三步、-可选-映射数据库到网页控制台" tabindex="-1">第三步、（可选）映射数据库到网页控制台 <a class="header-anchor" href="#第三步、-可选-映射数据库到网页控制台" aria-label="Permalink to &quot;第三步、（可选）映射数据库到网页控制台&quot;">​</a></h4><p><a href="https://github.com/KimigaiiWuyi/WzryUID/blob/main/WzryUID/utils/database/models.py" target="_blank" rel="noreferrer">参考</a></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> gsuid_core.webconsole.mount_app </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> PageSchema, GsAdminModel, site</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 注意，管理模型【一定】要携带@site.register_admin</span></span>
<span class="line"><span style="color:#6A737D;"># 否则【无需管理员账户】也能在网页控制台中【看到该表并修改】</span></span>
<span class="line"><span style="color:#B392F0;">@site.register_admin</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WzryBindadmin</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">GsAdminModel</span><span style="color:#E1E4E8;">): </span><span style="color:#6A737D;"># 一定要继承自GsAdminModel</span></span>
<span class="line"><span style="color:#E1E4E8;">    pk_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;id&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 一般无需修改，代表主键映射</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#label自定义，icon可参考https://fontawesome.com/v4/icons/</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_schema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PageSchema(</span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;王者绑定管理&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">icon</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;fa fa-users&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 配置管理模型</span></span>
<span class="line"><span style="color:#E1E4E8;">    model </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> WzryBind </span><span style="color:#6A737D;"># 填入第一步中继承的模型即可</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">@site.register_admin</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">WzryUseradmin</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">GsAdminModel</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    pk_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;id&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_schema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PageSchema(</span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;王者CK管理&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">icon</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;fa fa-database&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 配置管理模型</span></span>
<span class="line"><span style="color:#E1E4E8;">    model </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> WzryUser</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> gsuid_core.webconsole.mount_app </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> PageSchema, GsAdminModel, site</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 注意，管理模型【一定】要携带@site.register_admin</span></span>
<span class="line"><span style="color:#6A737D;"># 否则【无需管理员账户】也能在网页控制台中【看到该表并修改】</span></span>
<span class="line"><span style="color:#6F42C1;">@site.register_admin</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WzryBindadmin</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">GsAdminModel</span><span style="color:#24292E;">): </span><span style="color:#6A737D;"># 一定要继承自GsAdminModel</span></span>
<span class="line"><span style="color:#24292E;">    pk_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 一般无需修改，代表主键映射</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#label自定义，icon可参考https://fontawesome.com/v4/icons/</span></span>
<span class="line"><span style="color:#24292E;">    page_schema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PageSchema(</span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;王者绑定管理&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">icon</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;fa fa-users&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 配置管理模型</span></span>
<span class="line"><span style="color:#24292E;">    model </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> WzryBind </span><span style="color:#6A737D;"># 填入第一步中继承的模型即可</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">@site.register_admin</span></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">WzryUseradmin</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">GsAdminModel</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    pk_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;id&#39;</span></span>
<span class="line"><span style="color:#24292E;">    page_schema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PageSchema(</span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;王者CK管理&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">icon</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;fa fa-database&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 配置管理模型</span></span>
<span class="line"><span style="color:#24292E;">    model </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> WzryUser</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div>`,10);function b(u,F,h,_,A,D){const l=o,p=e;return c(),t("div",null,[a("h1",E,[s("插件获取/调用/建立数据库(GsData.db)"),n(l,{type:"tip",text:"简单"}),s(),d]),n(p,{readTime:"1",words:"524"}),m])}const k=r(y,[["render",b]]);export{v as __pageData,k as default};
